{% extends "components/_main.jinja" %}

{% block title %}{{ 'New Article' if mode == 'new' else 'Edit Article' }}{% endblock %}

{% block main %}
<div class="card">
  <h2>{{ 'Create New Article' if mode == 'new' else 'Edit Article' }}</h2>
  <p class="muted">{{ 'Add a new article to your blog.' if mode == 'new' else 'Update article details below.' }}</p>

  <form action="" method="post" novalidate style="max-width:800px;margin:1rem auto;text-align:left;">
    {{ form.hidden_tag() }}
    
    <div style="margin-bottom:1.5rem;">
      {{ form.title.label(class="muted", style="display:block;margin-bottom:0.5rem;font-weight:500;") }}
      {{ form.title(class="form-input") }}
    </div>

    <div style="margin-bottom:1.5rem;">
      {{ form.summary.label(class="muted", style="display:block;margin-bottom:0.5rem;font-weight:500;") }}
      {{ form.summary(class="form-input") }}
      <small class="muted" style="display:block;margin-top:0.35rem;font-size:0.8rem;">Brief description shown in article listings</small>
    </div>

    <div style="margin-bottom:1.5rem;">
      {{ form.content.label(class="muted", style="display:block;margin-bottom:0.5rem;font-weight:500;") }}
      {{ form.content(class="form-input", id="markdown-editor") }}
      <small class="muted" style="display:block;margin-top:0.35rem;font-size:0.8rem;">Supports Markdown formatting with live preview</small>
    </div>

    <div style="margin-bottom:1.5rem;">
      <label style="display:flex;align-items:center;gap:0.75rem;cursor:pointer;">
        {{ form.published(style="width:auto;cursor:pointer;") }}
        <span class="muted" style="font-weight:500;">{{ form.published.label.text }}</span>
      </label>
      <small class="muted" style="display:block;margin-top:0.35rem;font-size:0.8rem;">{{ form.published.description }}</small>
    </div>

    <div style="margin-top:2rem; display:flex; gap:0.75rem; justify-content:flex-start;">
      {{ form.submit(class="button") }}
      <a class="button" href="{{ url_for('admin.dashboard') }}" style="display:flex; align-items:center; justify-content:center;">Cancel</a>
    </div>
  </form>
</div>

<!-- EasyMDE Markdown Editor -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css">
<script src="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const easyMDE = new EasyMDE({
    element: document.getElementById('markdown-editor'),
    spellChecker: false,
    autosave: {
      enabled: true,
      uniqueId: "article-content",
      delay: 1000,
    },
    placeholder: "Write your article content here using Markdown...",
    toolbar: [
      "bold", "italic", "heading", "|",
      "quote", "unordered-list", "ordered-list", "|",
      "link", "image", "|",
      "preview", "side-by-side", "fullscreen", "|",
      "guide"
    ],
    status: ["autosave", "lines", "words", "cursor"],
    insertTexts: {
      horizontalRule: ["", "\n\n-----\n\n"],
      image: ["![](http://", ")"],
      link: ["[", "](http://)"],
      table: ["", "\n\n| Column 1 | Column 2 | Column 3 |\n| -------- | -------- | -------- |\n| Text     | Text      | Text     |\n\n"],
    },
  });
});
</script>

<style>
/* Dark theme for EasyMDE to match site theme */
.EasyMDEContainer .CodeMirror {
  background: rgba(26, 26, 62, 0.5);
  color: var(--text);
  border: 1px solid var(--card-border);
  border-radius: 8px;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', monospace;
  font-size: 14px;
}

.EasyMDEContainer .CodeMirror-cursor {
  border-left-color: var(--cyan);
}

.editor-toolbar {
  background: rgba(26, 26, 62, 0.7);
  border: 1px solid var(--card-border);
  border-bottom: none;
  border-radius: 8px 8px 0 0;
  padding: 8px;
}

.editor-toolbar button {
  background: transparent;
  color: var(--cyan) !important;
  border: none;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.editor-toolbar button:hover,
.editor-toolbar button.active {
  background: rgba(6, 182, 212, 0.2);
  color: var(--light-purple) !important;
}

.editor-toolbar i.separator {
  border-left: 1px solid var(--card-border);
  border-right: 1px solid rgba(255, 255, 255, 0.05);
}

.editor-statusbar {
  background: rgba(26, 26, 62, 0.7);
  color: var(--muted);
  border: 1px solid var(--card-border);
  border-top: none;
  border-radius: 0 0 8px 8px;
  padding: 8px 10px;
}

.editor-preview,
.editor-preview-side {
  background: rgba(10, 10, 26, 0.8);
  color: var(--text);
}

.editor-preview h1,
.editor-preview-side h1 {
  color: var(--cyan);
  border-bottom: 2px solid var(--cyan);
}

.editor-preview h2,
.editor-preview-side h2 {
  color: var(--light-purple);
  border-bottom: 1px solid var(--card-border);
}

.editor-preview a,
.editor-preview-side a {
  color: var(--cyan);
}

.editor-preview code,
.editor-preview-side code {
  background: rgba(26, 26, 62, 0.7);
  color: var(--light-purple);
  padding: 2px 6px;
  border-radius: 4px;
}

.editor-preview pre,
.editor-preview-side pre {
  background: rgba(26, 26, 62, 0.7);
  border: 1px solid var(--card-border);
  border-radius: 8px;
}

.CodeMirror-selected {
  background: rgba(6, 182, 212, 0.2) !important;
}

.CodeMirror-focused .CodeMirror-selected {
  background: rgba(6, 182, 212, 0.3) !important;
}
</style>

{% endblock %}
