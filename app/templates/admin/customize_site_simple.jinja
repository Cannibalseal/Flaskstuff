{% extends "components/_main.jinja" %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
<style>
    .CodeMirror { height: 300px; border-radius: 4px; border: 1px solid var(--card-border); }
    .section-title { margin-top: 2rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--card-border); color: var(--cyan); }
</style>
{% endblock %}

{% block title %}Customize Site{% endblock %}

{% block main %}
<div class="card">
    <h2>Customize Site</h2>
    <p class="muted">Adjust your site's appearance and content.</p>

    <form method="POST" action="" enctype="multipart/form-data" style="margin-top: 1.5rem;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <h3 class="section-title">General Settings</h3>
        <div class="form-group">
            <label for="site_name">Site Name</label>
            <input type="text" id="site_name" name="site_name" value="{{ settings.site_name }}" required>
        </div>
        <div class="form-group">
            <label for="site_tagline">Tagline</label>
            <input type="text" id="site_tagline" name="site_tagline" value="{{ settings.site_tagline }}">
        </div>

        <h3 class="section-title">Page Content</h3>
        <div class="form-group">
            <label for="welcome_page_content">Welcome Page Content (HTML)</label>
            <textarea id="welcome_page_content" name="welcome_page_content">{{ settings.welcome_page_content }}</textarea>
        </div>
        <div class="form-group">
            <label for="about_page_content">About Page Content (HTML)</label>
            <textarea id="about_page_content" name="about_page_content">{{ settings.about_page_content }}</textarea>
        </div>

        <h3 class="section-title">Images</h3>
        <div class="form-group">
            <label for="logo">Site Logo</label>
            {% if settings.logo_path %}
                <div style="margin-bottom: 0.5rem;">
                    <img src="{{ url_for('static', filename=settings.logo_path) }}" alt="Current Logo" style="max-height: 50px;">
                </div>
            {% endif %}
            <input type="file" id="logo" name="logo" accept="image/*">
        </div>
        <div class="form-group">
            <label for="favicon">Favicon</label>
            {% if settings.favicon_path %}
                <div style="margin-bottom: 0.5rem;">
                    <img src="{{ url_for('static', filename=settings.favicon_path) }}" alt="Current Favicon" style="max-height: 32px;">
                </div>
            {% endif %}
            <input type="file" id="favicon" name="favicon" accept="image/*">
        </div>

        <h3 class="section-title">Features</h3>
        <div class="form-group-checkbox">
            <input type="checkbox" id="enable_comments" name="enable_comments" {% if settings.enable_comments %}checked{% endif %}>
            <label for="enable_comments">Enable Comments</label>
        </div>
        <div class="form-group-checkbox">
            <input type="checkbox" id="enable_likes" name="enable_likes" {% if settings.enable_likes %}checked{% endif %}>
            <label for="enable_likes">Enable Likes</label>
        </div>
        <div class="form-group-checkbox">
            <input type="checkbox" id="enable_newsletter" name="enable_newsletter" {% if settings.enable_newsletter %}checked{% endif %}>
            <label for="enable_newsletter">Enable Newsletter</label>
        </div>

        <div style="margin-top: 2rem; display: flex; gap: 1rem;">
            <button type="submit" class="button">Save Changes</button>
            <a href="{{ url_for('admin.dashboard') }}" class="button-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const editorConfig = {
        lineNumbers: true,
        mode: 'htmlmixed',
        theme: 'dracula',
        lineWrapping: true,
        indentUnit: 4
    };

    CodeMirror.fromTextArea(document.getElementById('welcome_page_content'), editorConfig);
    CodeMirror.fromTextArea(document.getElementById('about_page_content'), editorConfig);
});
</script>
{% endblock %}